\documentclass[12pt,oneside]{book}
\usepackage[UTF8]{ctex}
\usepackage{amsmath}
\usepackage{color}
\usepackage[margin=1.00in]{geometry} 
\setlength{\parindent}{2em} 
\usepackage{graphicx}
\usepackage{hyperref} 
\usepackage{listings}
\usepackage[T1]{fontenc}
\usepackage{amsfonts}
\usepackage{todonotes}
\usepackage{algorithm}
\usepackage[noend]{algorithmic}
\setlength{\marginparwidth}{2cm}
\usepackage{enumitem}
\setlist{nosep}
\DeclareMathOperator*{\argminA}{arg\,min}
\DeclareMathOperator*{\argmaxA}{arg\,max}
\usepackage{tcolorbox}
\tcbset{colback=blue!10,colframe=blue!45
       ,coltitle=black,fonttitle=\bfseries}

\newcommand{\tab}[1][1cm]{\hspace*{#1}}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
     backgroundcolor=\color{backcolour},   
     commentstyle=\color{codegreen},
     keywordstyle=\color{magenta},
     numberstyle=\tiny\color{codegray},
     stringstyle=\color{codepurple},
     basicstyle=\footnotesize,
     breakatwhitespace=false,         
     breaklines=true,                 
     captionpos=b,                    
     keepspaces=true,                 
     numbers=left,                    
     numbersep=5pt,                  
     showspaces=false,                
     showstringspaces=false,
     showtabs=false,                  
     tabsize=2,
     language=C
     }
\lstset{style=mystyle, escapeinside={|}{|}}

%ensures that the "chapter 1" and the title of chapter are on same line
%the compact parameter ensures that the vertical spacing is less
\usepackage[compact]{titlesec}
\titleformat{\chapter}[hang] 
{\normalfont\Large\bfseries}{\chaptertitlename\ \thechapter:}{1em}{} 

\usepackage[thmmarks,thref,hyperref,amsmath]{ntheorem}
\theorembodyfont{\upshape\mdseries}
\newcommand*\phantomrel[1]{\mathrel{\phantom{#1}}}
% Use these for theorems, lemmas, proofs, etc.
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\newenvironment{proof}{{\bf Proof:}}{\hfill\rule{2mm}{2mm}}

%create shortcut for definition
\def\bdef{\begin{definition}}
\def\endef{\end{definition}}

\usepackage{mdframed}
\usepackage{color,soul}
\usepackage{mathtools}
\usepackage{amssymb}

%for the indentation of the "section", "subsection" and "chapter" titles 
\titleformat{\section}
{\normalfont\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}
{\normalfont\large\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}
{\normalfont\normalsize\bfseries}{\thesubsubsection}{1em}{}
\titleformat{\paragraph}[runin]
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titleformat{\subparagraph}[runin]
{\normalfont\normalsize\bfseries}{\thesubparagraph}{1em}{}

\def\Name{Ling Zhang}
\title{The Homework of CS285\\
\large Deep Reinforcement Learning}
\author{\Name}
\date{\today}

\begin{document}
\sloppy
\maketitle
\pagenumbering{roman}
\tableofcontents
\setcounter{tocdepth}{2}
\mainmatter
\newpage
\pagenumbering{arabic}

\chapter{Homework 1}

\section{Analysis}

\subsection{Part A}

这个作业相当于是slide里条件的弱化版本，slides里的条件是每个状态不等于专家状态的概率都为$\epsilon$，这里只是期望小于
$\epsilon$。

假设如下条件成立：
\begin{equation}
    \mathbb{E}_{p_{\pi^*}(s)} \left[\pi_{\theta}(a \ne \pi^*(s) \mid s)\right] 
    = \frac{1}{T} \sum_{t=1}^{T} \mathbb{E}_{p_{\pi^*}(s_t)} \left[\pi_{\theta}(a_t \ne \pi^*(s_t) \mid s_t)\right]
    \leq \epsilon
\end{equation}
在t时刻，$s_t$的状态分布为：
\begin{align}
    p_{\theta}(s_t) = 
    &(1 - \Pr[\cup_{t=1}^{t}\pi_{\theta}(a_t \ne \pi^*(s_t) \mid s_t)]) p_{\pi^*}(s_t) + 
    \Pr[\cup_{t=1}^{t}\pi_{\theta}(a_t \ne \pi^*(s_t) \mid s_t)] p_{\text{mistake}}(s_t)
\end{align}
两边同时减去$ p_{\pi^*}(s_t)$，得到：
\begin{align}
    |p_{\theta}(s_t) - p_{\pi^*}(s_t)| 
    &= \Pr\left[\cup_{t'=1}^{t} \left(\pi_{\theta}(a_{t} \ne \pi^*(s_{t}) \mid s_{t})\right)\right] \cdot |p_{\text{mistake}}(s_t) - p_{\pi^*}(s_t)| \nonumber \\
    &\leq 2\sum_{t=1}^{T}(\pi_{\theta}(a_{t} \ne \pi^*(s_{t}) \mid s_{t}))
\end{align}
所以：
\begin{align}
    \sum_{s_t}|p_{\theta}(s_t) - p_{\pi^*}(s_t)| 
    &\leq 2\sum_{t=1}^{T}\sum_{s_t}p_{\pi^*}(s_t)(\pi_{\theta}(a_{t} \ne \pi^*(s_{t}) \mid s_{t})) \nonumber \\
    &= 2\sum_{t=1}^{T}E_{p_{\pi^*}(s_t)}[\pi_{\theta}(a_{t} \ne \pi^*(s_{t}) \mid s_{t})] \nonumber \\
    &= 2T\epsilon
\end{align}
得证。

\subsection{Part B}
当奖励函数只与最后一个状态相关时，假设$J(\pi^*)$为专家策略的期望奖励，$J(\pi_{\theta})$为当前策略的期望奖励。
\begin{align}
    {J}(\pi^*) - {J}(\pi_{\theta}) 
    &= \sum_{t=1}^{T} (E_{p_{\pi^*}(s_t)}r(s_t) - E_{p_{\pi_{\theta}}(s_t)}r(s_t)) r(s_t)\nonumber \\
    &= \sum_{t=1}^{T} \sum_{s_t} (p_{\pi^*}(s_t)r(s_t) - p_{\pi_{\theta}}(s_t)r(s_t)) \nonumber \\
    &= \sum_{s_t} (p_{\pi^*}(s_t)r(s_t) - p_{\pi_{\theta}}(s_t)r(s_t)) \nonumber \\
    &\leq 2\epsilon T R_{\max}
\end{align}
所以：
\begin{equation}
    {J}(\pi^*) - {J}(\pi_{\theta}) = \mathbb{O}(T \epsilon)
\end{equation}

当为任意奖励时
\begin{align}
    {J}(\pi^*) - {J}(\pi_{\theta}) 
    &= \sum_{t=1}^{T} (E_{p_{\pi^*}(s_t)}r(s_t) - E_{p_{\pi_{\theta}}(s_t)}r(s_t)) r(s_t)\nonumber \\
    &= \sum_{t=1}^{T} \sum_{s_t} (p_{\pi^*}(s_t)r(s_t) - p_{\pi_{\theta}}(s_t)r(s_t)) \nonumber \\
    &\leq 2\epsilon T^2 R_{\max}
\end{align}
所以：
\begin{equation}
    {J}(\pi^*) - {J}(\pi_{\theta}) = \mathbb{O}(T^2 \epsilon)
\end{equation}

\section{Editing Coding}

\subsection{Part A}
% Part 3.1 Behavioral Cloning results table framework
\begin{table}[h!]
    \centering
    \caption{Part 3.1: Behavioral Cloning (BC) 结果表。报告两个任务（一个达到至少 \(30\%\) 专家性能，一个未达到）。表中为多条 rollout 的平均回报与标准差。公平对比细节（网络结构：\(n\_\text{layers}=\)?, \(\text{size}=\)?；训练：\(\text{steps/iter}=\)?, \(n\_\text{iter}=\)?；专家数据量：?；评估参数：\(\text{ep\_len}=\)?, \(\text{eval\_batch\_size}=\)?）请在本 caption 中注明。}
    \label{tab:bc_part3_1}
    \vspace{0.5em}
    \begin{tabular}{lcccc}
    \hline
    Environment & BC Mean Return & BC Std Return & Expert Mean Return & \% of Expert \\
    \hline
    Ant-v4 & 4786.60 & 54.70 & 4681.89 & 102.2\% \\
    HalfCheetah-v4 &  &  &  &  \\
    \hline
    \end{tabular}
\end{table}
    

\subsection{Part B}

\section{Discussion}

Your solution here.

\chapter{Homework 2}

\section{Introduction}

This is the second homework assignment for CS285.

\section{Problem 1}

Your solution here.

\section{Problem 2}

Your solution here.

\chapter{Homework 3}

\section{Introduction}

This is the third homework assignment for CS285.

\section{Problem 1}

Your solution here.

\section{Problem 2}

Your solution here.

\chapter{Homework 4}

\section{Introduction}

This is the fourth homework assignment for CS285.

\section{Problem 1}

Your solution here.

\section{Problem 2}

Your solution here.

\chapter{Homework 5}

\section{Introduction}

This is the fifth homework assignment for CS285.

\section{Problem 1}

Your solution here.

\section{Problem 2}

Your solution here.

\end{document} 